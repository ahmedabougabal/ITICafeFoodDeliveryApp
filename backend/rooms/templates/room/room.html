<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Chat</title>
</head>

<style>
    .chat-messages{
        height: 500px;
        overflow-y: auto;
    }

    .alert {
        display: block;
        width: fit-content; /* Allows divs to fit the content */
        padding: 5px; /* Optional: adds some spacing */
        margin: 5px 0; /* Adds vertical margin to separate messages */
        background-color: #cce5ff; /* Example background color */
        border: 1px solid #b8daff; /* Example border */
        border-radius: 0.25rem; /* Optional: rounded corners */
        max-width: 100%; /* Prevents it from overflowing the container */
    }

</style>

<body class="bg-light">
    <div class="alert alert-primary text-center fw-bold h2" role="alert">
        Welcome to Cafe Chat!
    </div>

    <div class="d-flex justify-content-center align-items-center vh-100">
        <div class="bg-white rounded shadow-sm p-4 col-6">
            <div id="chat_messages" class="chat-messages" style="max-height: 400px; overflow-y: auto;">
                    <!-- {% for message in messages %}
                        <div class="alert alert-primary text-center" role="alert">
                            {{ message.date_sent|date:"Y-m-d H:i" }}: <strong>{{ message.content }}</strong>
                        </div>
                    {% empty %}
                        <p> No messages in this room yet. </p>
                    {% endfor %} -->
            </div> <!-- Chat messages container -->

            <form id="chat_form" class="d-flex">
                {% csrf_token %}
                <input type="text" class="form-control me-2" aria-label="Chat input" id="chat_message_input" placeholder="Your message..." required autocomplete="off">
                <button type="submit" class="btn btn-primary" id="chat_message_send">Send</button>
            </form>
        </div>
    </div>
<!--     
    {{ request.user.email|json_script:"json-username" }}
    
    <script>
        const userEmail = JSON.parse(document.getElementById('json-username').textContent);
        console.log(userEmail)
        const chatSocket = new WebSocket(`ws://${window.location.host}/ws/${roomName}/`);

        chatSocket.onmessage = function(e) {
            console.log('On message');
            // const data = JSON.parse(e.data);
            
            // if (data.message) {
            //     const date = new Date();
            //     // Format the date as "Y-m-d H:i"
            //     const formattedDate = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;

            //     // Create a new message element
            //     let messageHtml = `
            //         <div class="alert alert-primary text-center" role="alert">
            //             <p><strong> ${data.email} </strong></p>
            //             <p>${formattedDate}: <strong>${data.message}</strong></p>
            //         </div>
            //     `;
            //     // Append the message to the chat_messages container
            //     document.querySelector('#chat_messages').innerHTML += messageHtml;
            //     //  call it when recieve message
            //     scrollToBottom()
            // } else {
            //     alert('The message was empty!');
            // }
        };

        chatSocket.onclose = function(e) {
            console.error('WebSocket closed unexpectedly');
        };

        document.querySelector('#chat_form').onsubmit = function(e) {

            e.preventDefault(); 
            const messageInput = document.querySelector('#chat_message_input');
            const message = messageInput.value;

            // Send the message through WebSocket
            chatSocket.send(JSON.stringify({
                'message': message,
                'email' : userEmail
            }));

            // Clear the input field
            messageInput.value = '';
            return false; // Prevent form submission
        };


        function scrollToBottom(){
            const chatBox = document.querySelector('#chat_messages')
            chatBox.scrollTop = chatBox.scrollHeight  // scrollTop specify the pixels will chatbox will move from top >> bottom
        }

        scrollToBottom()
    </script> -->
</body>
</html>
